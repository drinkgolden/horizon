{% liquid
  assign block_settings = block.settings
  assign row_classes = 'accordion-row accordion-row--special'
  assign resting_color_class = ''
  if block_settings.inherit_color_scheme == false
    assign row_classes = row_classes | append: ' color-' | append: block_settings.color_scheme
    assign resting_color_class = 'color-' | append: block_settings.color_scheme
  endif

  assign active_color_class = ''
  if block_settings.active_color_scheme != blank
    assign active_color_class = 'color-' | append: block_settings.active_color_scheme
  endif

  assign panel_height = 'auto'
  case block_settings.content_height
    when 'small'
      assign panel_height = 'min(28rem, 60vh)'
    when 'medium'
      assign panel_height = 'min(36rem, 70vh)'
    when 'large'
      assign panel_height = 'min(44rem, 80vh)'
    when 'xlarge'
      assign panel_height = 'min(52rem, 90vh)'
  endcase

  assign default_side = block_settings.default_active_side | default: 'left'
%}

<div
  class="{{ row_classes }}"
  data-special-row
  data-resting-color-class="{{ resting_color_class }}"
  data-active-color-class="{{ active_color_class }}"
  data-default-side="{{ default_side }}"
  data-bubble-divider="{{ block_settings.enable_bubble_divider }}"
>
  <accordion-custom
    class="accordion-row__inner{% if block_settings.inherit_color_scheme == false %} accordion-row--custom-scheme{% endif %}"
    {% if block_settings.open_by_default %}
      open-by-default-on-desktop
      open-by-default-on-mobile
    {% endif %}
    {% if block_settings.enable_hover_open %}
      data-hover-open="true"
    {% endif %}
  >
    <details
      class="details special-accordion-details"
      data-testid="accordion-details"
      data-special-accordion
      data-default-side="{{ default_side }}"
      {{ block.shopify_attributes }}
    >
      {% if block_settings.enable_bubble_divider %}
        <div class="special-accordion__bubble" aria-hidden="true">
          <svg
            viewBox="0 0 718 23"
            role="presentation"
            focusable="false"
          >
            <path d="M718 23L449.731 22.8344C444.385 22.8344 439.637 19.7478 437.96 15.1586C435.201 7.6213 427.866 2.58574 419.677 2.58574H282.855C274.667 2.58574 267.331 7.64911 264.573 15.1586C262.895 19.7478 258.175 22.8343 252.801 22.8343L0 23L0 20.4414L252.801 20.2758C257.066 20.2758 260.82 17.8556 262.099 14.2677C265.227 5.72915 273.558 0 282.827 0H419.648C428.918 0 437.249 5.72915 440.376 14.2677C441.684 17.8556 445.438 20.248 449.674 20.2758L717.943 20.4415V23H718Z"></path>
          </svg>
        </div>
      {% endif %}

      <summary
        class="details__header special-accordion-summary"
        data-summary-underline="{{ block_settings.enable_heading_underline }}"
      >
        <div class="special-accordion-summary__text" data-summary-text>
          <span class="special-accordion-summary__heading special-accordion-summary__heading--left" data-side="left">
            <span class="special-accordion-summary__label">{{ block_settings.heading }}</span>
            <span class="special-accordion-summary__caret" aria-hidden="true">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </span>
          {% if block_settings.right_heading != blank %}
            <span class="special-accordion-summary__heading special-accordion-summary__heading--right" data-side="right">
              <span class="special-accordion-summary__label">{{ block_settings.right_heading }}</span>
              <span class="special-accordion-summary__caret" aria-hidden="true">
                {{- 'icon-caret.svg' | inline_asset_content -}}
              </span>
            </span>
          {% endif %}
        </div>
      </summary>

      <div class="details-content special-accordion-content" style="--special-row-height: {{ panel_height }};">
        <div class="special-row__reveals" data-row-reveals="{{ block.id }}">
          {% content_for 'blocks' %}
        </div>
      </div>
    </details>
  </accordion-custom>
</div>

{% stylesheet %}
  .accordion-row--special {
    position: relative;
    overflow: hidden;
  }

  .special-accordion-details {
    position: relative;
  }

  .special-accordion__bubble {
    position: absolute;
    top: -1px;
    left: 0;
    right: 0;
    height: 24px;
    display: flex;
    justify-content: center;
    pointer-events: none;
  }

  .special-accordion__bubble svg {
    width: 220px;
    height: 100%;
    fill: var(--accordion-divider-color, var(--color-border));
  }

  .accordion-row--special .special-accordion-summary {
    display: flex;
    width: 100%;
    align-items: stretch;
    gap: var(--margin-sm);
    position: relative;
    cursor: pointer;
  }

  .accordion-row--special .special-accordion-summary__text {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    align-items: center;
    gap: var(--margin-md);
    width: 100%;
  }

  .special-accordion-summary__heading {
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--margin-xs);
    padding-block: var(--margin-xxs);
    padding-inline: var(--margin-xxs);
    position: relative;
  }

  .special-accordion-summary__heading--right {
    justify-content: flex-end;
    text-align: right;
  }

  .special-accordion-summary__label {
    position: relative;
    display: inline-flex;
    align-items: center;
  }

  .special-accordion-summary[data-summary-underline='true'] .special-accordion-summary__label::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -0.1em;
    width: 100%;
    height: 0.08em;
    background-color: currentColor;
    transform-origin: left;
    transform: scaleX(0);
    transition: transform 160ms var(--ease-out);
  }

  .special-accordion-summary__heading.is-hovered .special-accordion-summary__label::after {
    transform: scaleX(1);
  }

  .special-accordion-summary__caret {
    opacity: 0;
    transform: translateY(-0.25em);
    transition: opacity 160ms var(--ease-out), transform 200ms var(--ease-out);
    display: inline-flex;
  }

  .special-accordion-summary__heading.is-hovered .special-accordion-summary__caret {
    opacity: 1;
    transform: translateY(0);
  }

  .special-accordion-content {
    overflow: hidden;
    transition: height 240ms var(--ease-out), opacity 160ms var(--ease-out);
    min-height: var(--special-row-height, auto);
  }

  .special-row__reveals {
    position: relative;
    min-height: var(--special-row-min-height, 0px);
    transition: min-height 220ms var(--ease-out);
  }

  .special-row__reveal {
    position: absolute;
    inset: 0;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 200ms var(--ease-out), visibility 200ms var(--ease-out);
  }

  .special-row__reveal-inner {
    display: grid;
    gap: var(--margin-lg);
  }

  .special-row__reveal[data-active='true'] {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .special-row__section {
    display: grid;
    gap: var(--gap-lg, 1.5rem);
  }

  .special-row__section--editorial,
  .special-row__section--iwt {
    grid-template-columns: repeat(auto-fit, minmax(220px, 1fr));
    align-items: stretch;
  }

  .special-row__section--split {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    gap: clamp(1.5rem, 2vw, 2.5rem);
  }

  .special-row__split-pane {
    display: grid;
    gap: var(--gap-md);
  }

  .special-row__section--iwt-right {
    direction: rtl;
  }

  .special-row__section--iwt-right > * {
    direction: ltr;
  }

  .special-row__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: var(--style-border-radius-md);
  }

  .special-row__body {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    justify-content: center;
  }

  .special-row__caption {
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: var(--font-size--xs);
    margin: 0;
  }

  .special-row__heading {
    margin: 0;
    font-family: var(--font-heading--family, inherit);
    font-size: clamp(1.25rem, 1.2vw + 1rem, 2rem);
  }

  .special-row__manual-blocks > * + * {
    margin-block-start: var(--margin-md);
  }

  .special-row__section--pull-quote {
    text-align: center;
    justify-items: center;
  }

  .special-row__quote {
    font-size: clamp(1.5rem, 2vw + 1rem, 2.5rem);
    margin: 0;
  }

  .special-row__quote-meta {
    opacity: 0.8;
    margin: 0;
  }

  .special-row__section--video {
    position: relative;
  }

  .special-row__deferred-video {
    width: 100%;
  }

  .special-row__section--hero {
    position: relative;
    border-radius: var(--style-border-radius-lg, 24px);
    overflow: hidden;
  }

  .special-row__hero-media {
    position: relative;
  }

  .special-row__hero-image {
    width: 100%;
    height: clamp(320px, 50vw, 540px);
    object-fit: cover;
    display: block;
  }

  .special-row__hero-overlay {
    position: absolute;
    inset: 0;
    background: linear-gradient(180deg, rgb(0 0 0 / 0) 0%, rgb(0 0 0 / 0.65) 100%);
    display: flex;
    align-items: flex-end;
    padding: clamp(1.5rem, 4vw, 3rem);
  }

  .special-row__body--hero {
    color: var(--color-foreground, #fff);
  }

  .special-row__section--icons .special-row__icons-grid {
    display: grid;
    grid-template-columns: repeat(var(--special-icon-columns, 3), minmax(0, 1fr));
    gap: var(--margin-lg);
  }

  .special-row__icon {
    text-align: center;
    padding: var(--margin-md);
  }

  .special-row__icon-image {
    max-width: 72px;
    margin-inline: auto;
    margin-block-end: var(--margin-sm);
  }

  .special-row__icon-heading {
    font-weight: 600;
    margin: 0;
  }

  .special-row__icon-text {
    font-size: var(--font-size--sm);
    opacity: 0.8;
  }

  .special-row__section--marquee {
    overflow: hidden;
  }

  .special-row__marquee {
    display: block;
  }

  .special-row__section--marquee .marquee__wrapper {
    display: flex;
    gap: var(--marquee-gap);
    width: fit-content;
    white-space: nowrap;
  }

  .special-row__section--marquee .marquee__content {
    display: flex;
    gap: var(--marquee-gap);
  }

  .special-row__section--marquee .marquee__repeated-items {
    display: flex;
    gap: var(--marquee-gap);
    align-items: center;
  }

  .special-row__marquee-item {
    font-size: clamp(1.25rem, 1.5vw + 0.75rem, 2rem);
    font-weight: 600;
    text-transform: uppercase;
    letter-spacing: 0.08em;
  }

  .special-row__slideshow {
    width: 100%;
  }

  .special-row__section--slideshow {
    position: relative;
  }

  .special-row__slide {
    position: relative;
    min-height: 320px;
  }

  .special-row__slide-media {
    position: absolute;
    inset: 0;
    overflow: hidden;
  }

  .special-row__slide-image {
    width: 100%;
    height: 100%;
    object-fit: cover;
  }

  .special-row__slide-content {
    position: relative;
    z-index: 1;
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    padding: clamp(1.5rem, 4vw, 3rem);
    width: min(520px, 85%);
  }

  @media screen and (max-width: 749px) {
    .special-accordion-summary__text {
      grid-template-columns: 1fr;
    }

    .special-accordion-summary__heading {
      justify-content: flex-start;
      text-align: left;
    }

    .special-accordion-summary__heading--right {
      justify-content: flex-end;
      text-align: right;
      width: 100%;
    }

    .special-row__section--hero .special-row__hero-image {
      height: clamp(260px, 60vw, 420px);
    }

    .special-row__section--split {
      grid-template-columns: 1fr;
    }

    .special-row__icons-grid {
      grid-template-columns: repeat(2, minmax(0, 1fr));
    }

    .special-row__slide-content {
      width: 100%;
    }
  }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Special row",
  "tag": null,
  "blocks": [
    {
      "type": "_special-accordion-reveal",
      "name": "Reveal content",
      "limit": 2
    }
  ],
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Left heading",
      "default": "Special row heading"
    },
    {
      "type": "text",
      "id": "right_heading",
      "label": "Right heading",
      "default": ""
    },
    {
      "type": "select",
      "id": "default_active_side",
      "label": "Default reveal",
      "options": [
        {
          "value": "left",
          "label": "Left heading"
        },
        {
          "value": "right",
          "label": "Right heading"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "content_height",
      "label": "Reveal height",
      "options": [
        {
          "value": "auto",
          "label": "Auto"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        },
        {
          "value": "xlarge",
          "label": "Extra large"
        }
      ],
      "default": "auto"
    },
    {
      "type": "checkbox",
      "id": "enable_heading_underline",
      "label": "Underline headings on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_bubble_divider",
      "label": "Show bubble divider",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Open row by default",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_hover_open",
      "label": "Open on hover (desktop)",
      "default": false,
      "info": "When enabled, this row opens while hovered on desktop. Mobile behavior is unchanged."
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "Inherit color scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Row color scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "color_scheme",
      "id": "active_color_scheme",
      "label": "Active color scheme",
      "default": "scheme-2",
      "info": "Applied on hover and while the row is expanded."
    }
  ],
  "presets": [
    {
      "name": "Special row",
      "blocks": {
        "left_reveal": {
          "type": "_special-accordion-reveal",
          "settings": {
            "slot": "left"
          }
        },
        "right_reveal": {
          "type": "_special-accordion-reveal",
          "settings": {
            "slot": "right"
          }
        }
      },
      "block_order": ["left_reveal", "right_reveal"]
    }
  ]
}
{% endschema %}
