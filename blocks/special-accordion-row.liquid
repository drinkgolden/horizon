{% assign block_settings = block.settings %}
{% assign row_classes = 'accordion-row accordion-row--special' %}
{% if block_settings.inherit_color_scheme == false %}
  {% assign row_classes = row_classes | append: ' color-' | append: block_settings.color_scheme %}
{% endif %}

<div class="{{ row_classes }}">
  <accordion-custom
    class="accordion-row__inner{% if block_settings.inherit_color_scheme == false %} accordion-row--custom-scheme{% endif %}"
    {% if block_settings.open_by_default %}
      open-by-default-on-desktop
      open-by-default-on-mobile
    {% endif %}
    {% if block_settings.enable_hover_open %}
      data-hover-open="true"
    {% endif %}
  >
    <details
      class="details"
      data-testid="accordion-details"
      {{ block.shopify_attributes }}
    >
      <summary class="details__header special-accordion-summary">
        <div class="special-accordion-summary__text">
          <span class="special-accordion-summary__left">{{ block_settings.heading }}</span>
          {% if block_settings.right_heading != blank %}
            <span class="special-accordion-summary__right">{{ block_settings.right_heading }}</span>
          {% endif %}
        </div>
        <span class="svg-wrapper icon-caret icon-animated">
          {{- 'icon-caret.svg' | inline_asset_content -}}
        </span>
        <span class="svg-wrapper icon-plus">
          {{- 'icon-plus.svg' | inline_asset_content -}}
        </span>
      </summary>

      <div class="details-content">
        {% case block_settings.content_type %}
          {% when 'editorial' %}
            <div class="special-row__section special-row__section--editorial">
              {% if block_settings.editorial_image != blank %}
                <div class="special-row__media">
                  {{
                    block_settings.editorial_image
                    | image_url: width: 1200
                    | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 50vw, 100vw'
                  }}
                </div>
              {% endif %}
              <div class="special-row__body">
                {% if block_settings.editorial_caption != blank %}
                  <p class="special-row__caption">{{ block_settings.editorial_caption }}</p>
                {% endif %}
                {% if block_settings.editorial_heading != blank %}
                  <h3 class="special-row__heading">{{ block_settings.editorial_heading }}</h3>
                {% endif %}
                {% if block_settings.editorial_content != blank %}
                  <div class="special-row__text rte">{{ block_settings.editorial_content }}</div>
                {% endif %}
                {% if block_settings.editorial_button_label != blank and block_settings.editorial_button_link != blank %}
                  <a class="button button--link special-row__button" href="{{ block_settings.editorial_button_link }}">
                    {{- block_settings.editorial_button_label -}}
                  </a>
                {% endif %}
              </div>
            </div>
          {% when 'image_with_text' %}
            <div class="special-row__section special-row__section--iwt special-row__section--iwt-{{ block_settings.iwt_image_position }}">
              {% if block_settings.iwt_image != blank %}
                <div class="special-row__media">
                  {{
                    block_settings.iwt_image
                    | image_url: width: 1200
                    | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 50vw, 100vw'
                  }}
                </div>
              {% endif %}
              <div class="special-row__body">
                {% if block_settings.iwt_heading != blank %}
                  <h3 class="special-row__heading">{{ block_settings.iwt_heading }}</h3>
                {% endif %}
                {% if block_settings.iwt_text != blank %}
                  <div class="special-row__text rte">{{ block_settings.iwt_text }}</div>
                {% endif %}
                {% if block_settings.iwt_button_label != blank and block_settings.iwt_button_link != blank %}
                  <a class="button button--primary special-row__button" href="{{ block_settings.iwt_button_link }}">
                    {{- block_settings.iwt_button_label -}}
                  </a>
                {% endif %}
              </div>
            </div>
        {% endcase %}

        {% content_for 'blocks' %}
      </div>
    </details>
  </accordion-custom>
</div>

{% stylesheet %}
  .accordion-row--special .special-accordion-summary {
    display: flex;
    align-items: center;
    gap: var(--margin-sm);
    width: 100%;
  }

  .accordion-row--special .special-accordion-summary__text {
    flex: 1;
    display: flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--margin-md);
  }

  .accordion-row--special .special-accordion-summary__right {
    text-align: right;
    color: color-mix(in srgb, currentColor 80%, transparent);
  }

  .accordion-row--special .special-row__section {
    display: grid;
    gap: var(--gap-lg, 1.5rem);
    margin-block-end: var(--margin-xl);
  }

  .accordion-row--special .special-row__section--editorial,
  .accordion-row--special .special-row__section--iwt {
    grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
    align-items: stretch;
  }

  .accordion-row--special .special-row__section--iwt-right {
    direction: rtl;
  }

  .accordion-row--special .special-row__section--iwt-right > * {
    direction: ltr;
  }

  .accordion-row--special .special-row__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: var(--style-border-radius-md);
  }

  .accordion-row--special .special-row__body {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    justify-content: center;
  }

  .accordion-row--special .special-row__caption {
    text-transform: uppercase;
    letter-spacing: 0.1em;
    font-size: var(--font-size--xs);
    margin: 0;
  }

  .accordion-row--special .special-row__heading {
    margin: 0;
    font-family: var(--font-heading--family, inherit);
    font-size: clamp(1.25rem, 1.2vw + 1rem, 2rem);
  }

  .accordion-row--special .special-row__button {
    align-self: flex-start;
  }

  @media screen and (max-width: 749px) {
    .accordion-row--special .special-accordion-summary__text {
      flex-direction: column;
      align-items: flex-start;
    }

    .accordion-row--special .special-accordion-summary__right {
      text-align: left;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Special row",
  "tag": null,
  "blocks": [
    {
      "type": "@theme"
    },
    {
      "type": "@app"
    }
  ],
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Left heading",
      "default": "Special row heading"
    },
    {
      "type": "text",
      "id": "right_heading",
      "label": "Right heading",
      "default": ""
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Open row by default",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_hover_open",
      "label": "Open on hover (desktop)",
      "default": false,
      "info": "When enabled, this row opens while hovered on desktop. Mobile behavior is unchanged."
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "Inherit color scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Color scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "header",
      "content": "Content"
    },
    {
      "type": "select",
      "id": "content_type",
      "label": "Reveal content type",
      "options": [
        {
          "value": "none",
          "label": "None"
        },
        {
          "value": "editorial",
          "label": "Editorial"
        },
        {
          "value": "image_with_text",
          "label": "Image with text"
        }
      ],
      "default": "none"
    },
    {
      "type": "image_picker",
      "id": "editorial_image",
      "label": "Editorial image",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "text",
      "id": "editorial_caption",
      "label": "Editorial caption",
      "default": "Bestseller",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "text",
      "id": "editorial_heading",
      "label": "Editorial heading",
      "default": "Signature products",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "inline_richtext",
      "id": "editorial_content",
      "label": "Editorial text",
      "default": "Made with care and sourced responsibly.",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "text",
      "id": "editorial_button_label",
      "label": "Editorial button label",
      "default": "Shop now",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "url",
      "id": "editorial_button_link",
      "label": "Editorial button link",
      "visible_if": "{{ block.settings.content_type == 'editorial' }}"
    },
    {
      "type": "image_picker",
      "id": "iwt_image",
      "label": "Image with text image",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    },
    {
      "type": "text",
      "id": "iwt_heading",
      "label": "Image with text heading",
      "default": "Image with text heading",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    },
    {
      "type": "inline_richtext",
      "id": "iwt_text",
      "label": "Image with text body",
      "default": "Pair imagery with supporting copy for a richer experience.",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    },
    {
      "type": "text",
      "id": "iwt_button_label",
      "label": "Image with text button label",
      "default": "Learn more",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    },
    {
      "type": "url",
      "id": "iwt_button_link",
      "label": "Image with text button link",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    },
    {
      "type": "select",
      "id": "iwt_image_position",
      "label": "Image position",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "left",
      "visible_if": "{{ block.settings.content_type == 'image_with_text' }}"
    }
  ]
}
{% endschema %}
