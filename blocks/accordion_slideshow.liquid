{% assign block_settings = block.settings %}
{% assign ratio_value = '' %}

{% case block_settings.image_ratio %}
  {% when 'portrait' %}
    {% assign ratio_value = '4 / 5' %}
  {% when 'square' %}
    {% assign ratio_value = '1 / 1' %}
  {% when 'landscape' %}
    {% assign ratio_value = '16 / 9' %}
  {% when 'widescreen' %}
    {% assign ratio_value = '21 / 9' %}
{% endcase %}

{% assign wrapper_classes = 'accordion-slideshow spacing-style' %}
{% if block_settings.layout == 'split' %}
  {% assign wrapper_classes = wrapper_classes | append: ' accordion-slideshow--split' %}
{% endif %}

{% assign slide_keys = 'one,two,three,four,five' | split: ',' %}
{% assign slide_count = 0 %}
{% capture slides_markup %}
  {% for key in slide_keys %}
    {% assign image_key = 'slide_' | append: key | append: '_image' %}
    {% assign heading_key = 'slide_' | append: key | append: '_heading' %}
    {% assign text_key = 'slide_' | append: key | append: '_text' %}
    {% assign button_label_key = 'slide_' | append: key | append: '_button_label' %}
    {% assign button_link_key = 'slide_' | append: key | append: '_button_link' %}

    {% assign image = block_settings[image_key] %}
    {% assign heading = block_settings[heading_key] %}
    {% assign text = block_settings[text_key] %}
    {% assign button_label = block_settings[button_label_key] %}
    {% assign button_link = block_settings[button_link_key] %}

    {% if image == blank and heading == blank and text == blank and button_label == blank %}
      {% continue %}
    {% endif %}

    {% assign slide_count = slide_count | plus: 1 %}

    {% capture media_markup %}
      <div class="accordion-slideshow__media{% if ratio_value != blank %} accordion-slideshow__media--has-ratio{% endif %}" {% if ratio_value != blank %}style="--accordion-slideshow-ratio: {{ ratio_value }}"{% endif %}>
        {% if image != blank %}
          {{
            image
            | image_url: width: 2048
            | image_tag:
              loading: 'lazy',
              sizes: '(min-width: 990px) 60vw, 100vw',
              widths: '832, 1200, 1600, 2048',
              class: 'accordion-slideshow__image'
          }}
        {% else %}
          <div class="accordion-slideshow__placeholder">
            {{ 'hero-apparel-2' | placeholder_svg_tag: 'accordion-slideshow__placeholder-image' }}
          </div>
        {% endif %}
      </div>
    {% endcapture %}

    {% capture slide_content %}
      {% if heading != blank or text != blank or button_label != blank %}
        <div class="accordion-slideshow__slide-content">
          {% if heading != blank %}
            <p class="accordion-slideshow__slide-heading">{{ heading }}</p>
          {% endif %}
          {% if text != blank %}
            <div class="accordion-slideshow__slide-text rte">{{ text }}</div>
          {% endif %}
          {% if button_label != blank and button_link != blank %}
            <a class="button button--link accordion-slideshow__slide-button" href="{{ button_link }}">
              {{- button_label -}}
            </a>
          {% endif %}
        </div>
      {% endif %}
    {% endcapture %}

    <slideshow-slide class="accordion-slideshow__slide">
      {{ media_markup }}
      {{ slide_content }}
    </slideshow-slide>
  {% endfor %}
{% endcapture %}

{% if slide_count == 0 %}
  {% assign slide_count = 1 %}
  {% capture slides_markup %}
    <slideshow-slide class="accordion-slideshow__slide">
      <div class="accordion-slideshow__media accordion-slideshow__media--placeholder">
        {{ 'hero-apparel-2' | placeholder_svg_tag: 'accordion-slideshow__placeholder-image' }}
      </div>
    </slideshow-slide>
  {% endcapture %}
{% endif %}

{% capture controls %}
  {% if slide_count > 1 and block_settings.controls_style != 'none' %}
    {%- render 'slideshow-controls',
      style: block_settings.controls_style,
      autoplay: block_settings.autoplay,
      item_count: slide_count,
      show_arrows: false,
      arrows_on_media: false,
      controls_on_media: false,
      pagination_position: block_settings.pagination_position,
      icon_style: block_settings.icons_style
    -%}
  {% endif %}
{% endcapture %}

{% assign show_arrows = false %}
{% if block_settings.show_arrows and slide_count > 1 %}
  {% assign show_arrows = true %}
{% endif %}

<div
  class="{{ wrapper_classes }}"
  style="{% render 'spacing-style', settings: block_settings %}"
  {{ block.shopify_attributes }}
>
  {% if block_settings.heading != blank or block_settings.subheading != blank %}
    <div class="accordion-slideshow__intro">
      {% if block_settings.heading != blank %}
        <p class="accordion-slideshow__eyebrow">{{ block_settings.heading }}</p>
      {% endif %}
      {% if block_settings.subheading != blank %}
        <div class="accordion-slideshow__text rte">{{ block_settings.subheading }}</div>
      {% endif %}
    </div>
  {% endif %}

  {% render 'slideshow',
    class: 'accordion-slideshow__component',
    slides: slides_markup,
    controls: controls,
    show_arrows: show_arrows,
    icon_style: block_settings.icons_style,
    autoplay: block_settings.autoplay,
    autoplay_speed: block_settings.autoplay_speed,
    slide_count: slide_count,
    slide_size: block_settings.slide_height
  %}
</div>

{% stylesheet %}
  .accordion-slideshow {
    width: 100%;
    display: flex;
    flex-direction: column;
    gap: var(--margin-md);
  }

  .accordion-slideshow__intro {
    display: flex;
    flex-direction: column;
    gap: var(--margin-xs);
  }

  .accordion-slideshow__text :is(p, ul, ol) {
    margin: 0;
  }

  .accordion-slideshow__component {
    width: 100%;
  }

  slideshow-slide.accordion-slideshow__slide {
    display: flex;
    flex-direction: column;
    gap: var(--margin-md);
  }

  .accordion-slideshow--split slideshow-slide.accordion-slideshow__slide {
    @media (min-width: 900px) {
      flex-direction: row;
      align-items: center;
    }
  }

  .accordion-slideshow__media {
    width: 100%;
    overflow: hidden;
    border-radius: var(--border-radius-sm, 0);
  }

  .accordion-slideshow__media--has-ratio {
    aspect-ratio: var(--accordion-slideshow-ratio);
  }

  .accordion-slideshow__image {
    width: 100%;
    height: 100%;
    object-fit: cover;
    display: block;
  }

  .accordion-slideshow__slide-content {
    display: flex;
    flex-direction: column;
    gap: var(--margin-xs);
  }

  .accordion-slideshow__slide-heading {
    font-weight: var(--font-weight-bold);
    margin: 0;
  }

  .accordion-slideshow__slide-text :is(p, ul, ol) {
    margin: 0;
  }

  .accordion-slideshow__placeholder {
    aspect-ratio: 16 / 9;
    background: rgb(var(--color-foreground-rgb, 0 0 0) / 0.08);
    border-radius: var(--border-radius-sm, 0);
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Accordion slideshow",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Eyebrow heading"
    },
    {
      "type": "richtext",
      "id": "subheading",
      "label": "Intro text"
    },
    {
      "type": "select",
      "id": "layout",
      "label": "Layout",
      "options": [
        {
          "value": "stacked",
          "label": "Stacked"
        },
        {
          "value": "split",
          "label": "Split on desktop"
        }
      ],
      "default": "stacked"
    },
    {
      "type": "select",
      "id": "image_ratio",
      "label": "Image ratio",
      "options": [
        {
          "value": "adapt",
          "label": "Adapt to image"
        },
        {
          "value": "landscape",
          "label": "Landscape"
        },
        {
          "value": "portrait",
          "label": "Portrait"
        },
        {
          "value": "square",
          "label": "Square"
        },
        {
          "value": "widescreen",
          "label": "Widescreen"
        }
      ],
      "default": "adapt"
    },
    {
      "type": "checkbox",
      "id": "show_arrows",
      "label": "Show arrows",
      "default": true
    },
    {
      "type": "select",
      "id": "controls_style",
      "label": "Pagination style",
      "options": [
        {
          "value": "dots",
          "label": "Dots"
        },
        {
          "value": "counter",
          "label": "Counter"
        },
        {
          "value": "none",
          "label": "None"
        }
      ],
      "default": "dots"
    },
    {
      "type": "select",
      "id": "pagination_position",
      "label": "Controls alignment",
      "options": [
        {
          "value": "left",
          "label": "Left"
        },
        {
          "value": "center",
          "label": "Centre"
        },
        {
          "value": "right",
          "label": "Right"
        }
      ],
      "default": "center"
    },
    {
      "type": "select",
      "id": "icons_style",
      "label": "Icon style",
      "options": [
        {
          "value": "arrow",
          "label": "Arrows"
        },
        {
          "value": "chevron",
          "label": "Chevrons"
        },
        {
          "value": "arrows_large",
          "label": "Large arrows"
        },
        {
          "value": "chevron_large",
          "label": "Large chevrons"
        }
      ],
      "default": "chevron"
    },
    {
      "type": "checkbox",
      "id": "autoplay",
      "label": "Autoplay slides",
      "default": false
    },
    {
      "type": "range",
      "id": "autoplay_speed",
      "label": "Autoplay speed",
      "min": 3,
      "max": 7,
      "step": 1,
      "unit": "s",
      "default": 4,
      "visible_if": "{{ block.settings.autoplay }}"
    },
    {
      "type": "select",
      "id": "slide_height",
      "label": "Slide height",
      "options": [
        {
          "value": "auto",
          "label": "Auto"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        }
      ],
      "default": "auto"
    },
    {
      "type": "header",
      "content": "Padding"
    },
    {
      "type": "header",
      "content": "Slide content"
    },
    {
      "type": "paragraph",
      "content": "Add up to five slides. Leave a slide blank to hide it."
    },
    {
      "type": "image_picker",
      "id": "slide_one_image",
      "label": "Slide 1 image"
    },
    {
      "type": "text",
      "id": "slide_one_heading",
      "label": "Slide 1 heading"
    },
    {
      "type": "richtext",
      "id": "slide_one_text",
      "label": "Slide 1 text"
    },
    {
      "type": "text",
      "id": "slide_one_button_label",
      "label": "Slide 1 button label"
    },
    {
      "type": "url",
      "id": "slide_one_button_link",
      "label": "Slide 1 button link"
    },
    {
      "type": "image_picker",
      "id": "slide_two_image",
      "label": "Slide 2 image"
    },
    {
      "type": "text",
      "id": "slide_two_heading",
      "label": "Slide 2 heading"
    },
    {
      "type": "richtext",
      "id": "slide_two_text",
      "label": "Slide 2 text"
    },
    {
      "type": "text",
      "id": "slide_two_button_label",
      "label": "Slide 2 button label"
    },
    {
      "type": "url",
      "id": "slide_two_button_link",
      "label": "Slide 2 button link"
    },
    {
      "type": "image_picker",
      "id": "slide_three_image",
      "label": "Slide 3 image"
    },
    {
      "type": "text",
      "id": "slide_three_heading",
      "label": "Slide 3 heading"
    },
    {
      "type": "richtext",
      "id": "slide_three_text",
      "label": "Slide 3 text"
    },
    {
      "type": "text",
      "id": "slide_three_button_label",
      "label": "Slide 3 button label"
    },
    {
      "type": "url",
      "id": "slide_three_button_link",
      "label": "Slide 3 button link"
    },
    {
      "type": "image_picker",
      "id": "slide_four_image",
      "label": "Slide 4 image"
    },
    {
      "type": "text",
      "id": "slide_four_heading",
      "label": "Slide 4 heading"
    },
    {
      "type": "richtext",
      "id": "slide_four_text",
      "label": "Slide 4 text"
    },
    {
      "type": "text",
      "id": "slide_four_button_label",
      "label": "Slide 4 button label"
    },
    {
      "type": "url",
      "id": "slide_four_button_link",
      "label": "Slide 4 button link"
    },
    {
      "type": "image_picker",
      "id": "slide_five_image",
      "label": "Slide 5 image"
    },
    {
      "type": "text",
      "id": "slide_five_heading",
      "label": "Slide 5 heading"
    },
    {
      "type": "richtext",
      "id": "slide_five_text",
      "label": "Slide 5 text"
    },
    {
      "type": "text",
      "id": "slide_five_button_label",
      "label": "Slide 5 button label"
    },
    {
      "type": "url",
      "id": "slide_five_button_link",
      "label": "Slide 5 button link"
    }
  ],
  "presets": [
    {
      "name": "Accordion slideshow",
      "category": "Content"
    }
  ]
}
{% endschema %}
