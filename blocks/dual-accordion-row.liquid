{% assign s = block.settings %}
{% assign row_classes = 'dual-accordion-row' %}
{% if s.inherit_color_scheme == false %}
  {% assign row_classes = row_classes | append: ' color-' | append: s.color_scheme %}
{% endif %}

{% assign active_color_class = '' %}
{% if s.active_color_scheme != blank %}
  {% assign active_color_class = 'color-' | append: s.active_color_scheme %}
{% endif %}

{% assign panel_height = 'auto' %}
{% case s.content_height %}
  {% when 'small' %}
    {% assign panel_height = 'min(28rem, 60vh)' %}
  {% when 'medium' %}
    {% assign panel_height = 'min(36rem, 70vh)' %}
  {% when 'large' %}
    {% assign panel_height = 'min(44rem, 80vh)' %}
  {% when 'xlarge' %}
    {% assign panel_height = 'min(52rem, 90vh)' %}
{% endcase %}

{% assign left_has_content = false %}
{% if s.left_image != blank or s.left_caption != blank or s.left_heading != blank or s.left_body != blank or s.left_button_label != blank %}
  {% assign left_has_content = true %}
{% endif %}

{% assign right_has_content = false %}
{% if s.right_image != blank or s.right_caption != blank or s.right_reveal_heading != blank or s.right_body != blank or s.right_button_label != blank %}
  {% assign right_has_content = true %}
{% endif %}

{% assign default_side = s.default_active_side | default: 'left' %}

<div
  class="{{ row_classes }}"
  data-dual-row
  data-resting-color-class="{% if s.inherit_color_scheme == false %}color-{{ s.color_scheme }}{% endif %}"
  data-active-color-class="{{ active_color_class }}"
  data-default-side="{{ default_side }}"
  data-bubble-divider="{{ s.enable_bubble_divider }}"
  style="
    {% if s.summary_font_size != blank %}--dual-summary-font-size: {{ s.summary_font_size }};{% endif %}
    {% if s.reveal_heading_font_size != blank %}--dual-inner-heading-size: {{ s.reveal_heading_font_size }};{% endif %}
    {% if s.reveal_body_font_size != blank %}--dual-body-font-size: {{ s.reveal_body_font_size }};{% endif %}
  "
>
  <accordion-custom
    class="dual-accordion-row__inner{% if s.inherit_color_scheme == false %} dual-accordion-row__inner--custom{% endif %}"
    {% if s.open_by_default %}
      open-by-default-on-desktop
      open-by-default-on-mobile
    {% endif %}
    {% if s.enable_hover_open %}
      data-hover-open="true"
    {% endif %}
  >
    <details
      class="details dual-accordion-details"
      data-testid="accordion-details"
      data-dual-accordion
      data-default-side="{{ default_side }}"
      {{ block.shopify_attributes }}
    >
      {% if s.enable_bubble_divider %}
        <div class="dual-accordion__bubble" aria-hidden="true">
          <svg viewBox="0 0 718 23" role="presentation" focusable="false">
            <path d="M718 23L449.731 22.8344C444.385 22.8344 439.637 19.7478 437.96 15.1586C435.201 7.6213 427.866 2.58574 419.677 2.58574H282.855C274.667 2.58574 267.331 7.64911 264.573 15.1586C262.895 19.7478 258.175 22.8343 252.801 22.8343L0 23L0 20.4414L252.801 20.2758C257.066 20.2758 260.82 17.8556 262.099 14.2677C265.227 5.72915 273.558 0 282.827 0H419.648C428.918 0 437.249 5.72915 440.376 14.2677C441.684 17.8556 445.438 20.248 449.674 20.2758L717.943 20.4415V23H718Z" />
          </svg>
        </div>
      {% endif %}

      <summary
        class="details__header dual-accordion-summary"
        data-summary-underline="{{ s.enable_heading_underline }}"
      >
        <div class="dual-accordion-summary__text" data-summary-text>
          <span class="dual-accordion-summary__heading dual-accordion-summary__heading--left" data-side="left">
            <span class="dual-accordion-summary__label">{{ s.heading }}</span>
            <span class="dual-accordion-summary__caret" aria-hidden="true">
              {{- 'icon-caret.svg' | inline_asset_content -}}
            </span>
          </span>
    {% if s.right_heading != blank %}
      <span class="dual-accordion-summary__heading dual-accordion-summary__heading--right" data-side="right">
        <span class="dual-accordion-summary__label">{{ s.right_heading }}</span>
        <span class="dual-accordion-summary__caret" aria-hidden="true">
          {{- 'icon-caret.svg' | inline_asset_content -}}
        </span>
            </span>
          {% endif %}
        </div>
      </summary>

      <div class="details-content dual-accordion-content" style="--dual-row-height: {{ panel_height }};">
        <div class="dual-row__panes" data-row-reveals="{{ block.id }}">
          <div class="dual-row__pane dual-row__pane--left" data-slot="left" data-empty="{{ left_has_content | default: false | downcase }}">
            {% if s.left_image != blank %}
              <div class="dual-row__media">
                {{
                  s.left_image
                  | image_url: width: 1600
                  | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 50vw, 100vw'
                }}
              </div>
            {% endif %}
            <div class="dual-row__body">
              {% if s.left_caption != blank %}
                <p class="dual-row__caption">{{ s.left_caption }}</p>
              {% endif %}
              {% if s.left_heading != blank %}
                <h3 class="dual-row__heading">{{ s.left_heading }}</h3>
              {% endif %}
              {% if s.left_body != blank %}
                <div class="dual-row__text rte">{{ s.left_body }}</div>
              {% endif %}
              {% if s.left_button_label != blank and s.left_button_link != blank %}
                <a class="button button--primary dual-row__button" href="{{ s.left_button_link }}">
                  {{- s.left_button_label -}}
                </a>
              {% endif %}
            </div>
          </div>

          <div class="dual-row__pane dual-row__pane--right" data-slot="right" data-empty="{{ right_has_content | default: false | downcase }}">
            {% if s.right_image != blank %}
              <div class="dual-row__media">
                {{
                  s.right_image
                  | image_url: width: 1600
                  | image_tag: loading: 'lazy', sizes: '(min-width: 990px) 50vw, 100vw'
                }}
              </div>
            {% endif %}
            <div class="dual-row__body">
              {% if s.right_caption != blank %}
                <p class="dual-row__caption">{{ s.right_caption }}</p>
              {% endif %}
              {% if s.right_reveal_heading != blank %}
                <h3 class="dual-row__heading">{{ s.right_reveal_heading }}</h3>
              {% endif %}
              {% if s.right_body != blank %}
                <div class="dual-row__text rte">{{ s.right_body }}</div>
              {% endif %}
              {% if s.right_button_label != blank and s.right_button_link != blank %}
                <a class="button button--primary dual-row__button" href="{{ s.right_button_link }}">
                  {{- s.right_button_label -}}
                </a>
              {% endif %}
            </div>
          </div>
        </div>
      </div>
    </details>
  </accordion-custom>
</div>

{% stylesheet %}
  .dual-accordion-row {
    position: relative;
    overflow: hidden;
    width: 100%;
  }

  .dual-accordion-row accordion-custom,
  .dual-accordion-row .details,
  .dual-accordion-row .details__header,
  .dual-row__panes,
  .dual-row__pane {
    width: 100%;
  }

  .dual-accordion-row .dual-accordion-summary {
    display: flex;
    width: 100%;
    align-items: stretch;
    gap: var(--margin-sm);
    cursor: pointer;
  }

  .dual-accordion-summary__text {
    flex: 1;
    display: grid;
    grid-template-columns: repeat(2, minmax(0, 1fr));
    gap: var(--margin-md);
  }

  .dual-accordion-summary__heading {
    display: inline-flex;
    align-items: center;
    justify-content: space-between;
    gap: var(--margin-xxs);
    padding-block: var(--margin-xxs);
    font-size: var(--dual-summary-font-size, inherit);
  }

  .dual-accordion-summary__heading--right {
    justify-content: flex-end;
    text-align: right;
  }

  .dual-accordion-summary[data-summary-underline='true'] .dual-accordion-summary__label {
    position: relative;
  }

  .dual-accordion-summary[data-summary-underline='true'] .dual-accordion-summary__label::after {
    content: '';
    position: absolute;
    left: 0;
    bottom: -0.1em;
    width: 100%;
    height: 0.08em;
    background-color: currentColor;
    transform-origin: left;
    transform: scaleX(0);
    transition: transform 160ms var(--ease-out);
  }

  .dual-accordion-summary__heading.is-hovered .dual-accordion-summary__label::after {
    transform: scaleX(1);
  }

  .dual-accordion-summary__caret {
    opacity: 0;
    transform: translateY(-0.25em);
    transition: opacity 160ms var(--ease-out), transform 200ms var(--ease-out);
  }

  .dual-accordion-summary__heading.is-hovered .dual-accordion-summary__caret {
    opacity: 1;
    transform: translateY(0);
  }

  .dual-accordion-content {
    overflow: hidden;
    min-height: var(--dual-row-height, auto);
  }

  .dual-row__panes {
    position: relative;
    min-height: var(--dual-row-min-height, 0px);
    transition: min-height 220ms var(--ease-out);
  }

  .dual-row__pane {
    position: absolute;
    inset: 0;
    opacity: 0;
    visibility: hidden;
    pointer-events: none;
    transition: opacity 220ms var(--ease-out), visibility 220ms var(--ease-out);
    display: grid;
    gap: var(--margin-lg);
  }

  .dual-row__pane[data-active='true'] {
    opacity: 1;
    visibility: visible;
    pointer-events: auto;
  }

  .dual-row__media img {
    width: 100%;
    height: 100%;
    object-fit: cover;
    border-radius: var(--style-border-radius-md);
  }

  .dual-row__body {
    display: flex;
    flex-direction: column;
    gap: var(--gap-md);
    font-size: var(--dual-body-font-size, inherit);
  }

  .dual-row__caption {
    text-transform: uppercase;
    letter-spacing: 0.08em;
    font-size: var(--font-size--xs);
    margin: 0;
  }

  .dual-row__heading {
    margin: 0;
    font-family: var(--font-heading--family, inherit);
    font-size: clamp(1.25rem, 1.2vw + 1rem, 2rem);
  }

  .dual-accordion__bubble {
    position: absolute;
    top: -1px;
    left: 0;
    right: 0;
    height: 24px;
    display: flex;
    justify-content: center;
    pointer-events: none;
  }

  .dual-accordion__bubble svg {
    width: 220px;
    height: 100%;
    fill: var(--accordion-divider-color, var(--color-border));
  }

  @media screen and (max-width: 749px) {
    .dual-accordion-summary__text {
      grid-template-columns: 1fr;
    }

    .dual-accordion-summary__heading--right {
      justify-content: flex-start;
      text-align: left;
    }

    .dual-row__pane {
      position: relative;
      opacity: 1;
      visibility: visible;
      pointer-events: auto;
    }
  }
{% endstylesheet %}

{% schema %}
{
  "name": "Dual accordion row",
  "tag": null,
  "settings": [
    {
      "type": "text",
      "id": "heading",
      "label": "Left heading",
      "default": "Left reveal"
    },
    {
      "type": "text",
      "id": "right_heading",
      "label": "Right heading",
      "default": "Right reveal"
    },
    {
      "type": "select",
      "id": "summary_font_size",
      "label": "Summary heading size",
      "options": [
        {
          "value": "",
          "label": "Theme default"
        },
        {
          "value": "0.9rem",
          "label": "Small"
        },
        {
          "value": "1.1rem",
          "label": "Medium"
        },
        {
          "value": "1.4rem",
          "label": "Large"
        }
      ],
      "default": ""
    },
    {
      "type": "select",
      "id": "default_active_side",
      "label": "Default reveal",
      "options": [
        {
          "value": "left",
          "label": "Left heading"
        },
        {
          "value": "right",
          "label": "Right heading"
        }
      ],
      "default": "left"
    },
    {
      "type": "select",
      "id": "content_height",
      "label": "Reveal height",
      "options": [
        {
          "value": "auto",
          "label": "Auto"
        },
        {
          "value": "small",
          "label": "Small"
        },
        {
          "value": "medium",
          "label": "Medium"
        },
        {
          "value": "large",
          "label": "Large"
        },
        {
          "value": "xlarge",
          "label": "Extra large"
        }
      ],
      "default": "auto"
    },
    {
      "type": "checkbox",
      "id": "enable_heading_underline",
      "label": "Underline headings on hover",
      "default": true
    },
    {
      "type": "checkbox",
      "id": "enable_bubble_divider",
      "label": "Show bubble divider",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "open_by_default",
      "label": "Open row by default",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "enable_hover_open",
      "label": "Open on hover (desktop)",
      "default": false
    },
    {
      "type": "checkbox",
      "id": "inherit_color_scheme",
      "label": "Inherit color scheme",
      "default": true
    },
    {
      "type": "color_scheme",
      "id": "color_scheme",
      "label": "Row color scheme",
      "default": "scheme-1",
      "visible_if": "{{ block.settings.inherit_color_scheme == false }}"
    },
    {
      "type": "color_scheme",
      "id": "active_color_scheme",
      "label": "Active color scheme",
      "default": "scheme-2"
    },
    {
      "type": "header",
      "content": "Left reveal"
    },
    {
      "type": "select",
      "id": "reveal_heading_font_size",
      "label": "Reveal heading size",
      "options": [
        {
          "value": "",
          "label": "Theme default"
        },
        {
          "value": "1.125rem",
          "label": "Small"
        },
        {
          "value": "1.5rem",
          "label": "Medium"
        },
        {
          "value": "2rem",
          "label": "Large"
        }
      ],
      "default": ""
    },
    {
      "type": "select",
      "id": "reveal_body_font_size",
      "label": "Reveal body size",
      "options": [
        {
          "value": "",
          "label": "Theme default"
        },
        {
          "value": "0.95rem",
          "label": "Small"
        },
        {
          "value": "1.05rem",
          "label": "Medium"
        },
        {
          "value": "1.2rem",
          "label": "Large"
        }
      ],
      "default": ""
    },
    {
      "type": "image_picker",
      "id": "left_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "left_caption",
      "label": "Caption"
    },
    {
      "type": "text",
      "id": "left_heading",
      "label": "Heading",
      "default": "Left reveal headline"
    },
    {
      "type": "inline_richtext",
      "id": "left_body",
      "label": "Body",
      "default": "Describe the content revealed when the left heading is selected."
    },
    {
      "type": "text",
      "id": "left_button_label",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "left_button_link",
      "label": "Button link"
    },
    {
      "type": "header",
      "content": "Right reveal"
    },
    {
      "type": "image_picker",
      "id": "right_image",
      "label": "Image"
    },
    {
      "type": "text",
      "id": "right_caption",
      "label": "Caption"
    },
    {
      "type": "text",
      "id": "right_reveal_heading",
      "label": "Heading",
      "default": "Right reveal headline"
    },
    {
      "type": "inline_richtext",
      "id": "right_body",
      "label": "Body",
      "default": "Describe the content revealed when the right heading is selected."
    },
    {
      "type": "text",
      "id": "right_button_label",
      "label": "Button label"
    },
    {
      "type": "url",
      "id": "right_button_link",
      "label": "Button link"
    }
  ],
  "presets": [
    {
      "name": "Dual accordion row"
    }
  ]
}
{% endschema %}
