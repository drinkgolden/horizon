{% liquid
  assign padding = block.settings.content_padding | default: 40
  assign gap = block.settings.content_gap | default: 24
  assign alignment = block.settings.content_alignment | default: 'flex-start'
  assign spine_text = block.settings.spine_label | default: block.settings.heading
  assign heading_tag = block.settings.heading_tag | default: 'h3'
  assign has_image = block.settings.image != blank
  assign overlay_alpha = block.settings.overlay_opacity | default: 0 | times: 0.01
  assign overlay_color = block.settings.overlay_color | default: '#000000'
  assign overlay_rgb = overlay_color | color_to_rgb
%}

{% capture block_style %}
  --padding-block-start: {{ padding }}px;
  --padding-block-end: {{ padding }}px;
  --padding-inline-start: {{ padding }}px;
  --padding-inline-end: {{ padding }}px;
{% endcapture %}

{% capture content_style %}
  --gap: {{ gap }}px;
  --horizontal-alignment: flex-start;
  --vertical-alignment: {{ alignment }};
  --vertical-alignment-mobile: {{ alignment }};
{% endcapture %}

<div
  class="
    group-block
    group-block--height-fill
    group-block--width-fill
    border-style
    spacing-style
    size-style
    book-spine-panel
  "
  style="{{ block_style | strip }}"
  {{ block.shopify_attributes }}
>
  <div class="group-block__media-wrapper">
    {% if has_image %}
      {% render 'background-media',
        background_media: 'image',
        background_image: block.settings.image,
        background_image_position: block.settings.image_position,
        placeholder: block.settings.placeholder,
        block: block,
        section: section
      %}
    {% else %}
      {{ block.settings.placeholder | default: 'hero-apparel-2' | placeholder_svg_tag }}
    {% endif %}

    {% if overlay_alpha > 0 %}
      <span
        class="book-spine-panel__overlay"
        style="background-color: rgba({{ overlay_rgb }}, {{ overlay_alpha }});"
        aria-hidden="true"
      ></span>
    {% endif %}
  </div>

  <div
    class="
      group-block-content
      layout-panel-flex
      layout-panel-flex--column
      {% if block.settings.stack_mobile %}mobile-column{% endif %}
    "
    style="{{ content_style | strip }}"
  >
    {% if spine_text != blank %}
      <p class="book-spine-panel__spine" aria-hidden="true">
        {{ spine_text }}
      </p>
    {% endif %}

    <div
      class="book-spine-panel__content"
      style="--content-gap: {{ gap }}px;"
    >
      {% if block.settings.eyebrow != blank %}
        <p class="book-spine-panel__eyebrow">
          {{ block.settings.eyebrow }}
        </p>
      {% endif %}

      {% if block.settings.heading != blank %}
        <{{ heading_tag }} class="book-spine-panel__heading">
          {{ block.settings.heading }}
        </{{ heading_tag }}>
      {% endif %}

      {% if block.settings.body != blank %}
        <div class="book-spine-panel__body">
          {{ block.settings.body }}
        </div>
      {% endif %}

      {% if block.settings.button_label != blank %}
        {% assign has_link = block.settings.button_link != blank %}
        {% assign button_style = block.settings.button_style | default: 'button' %}
        <a
          {% if has_link %}
            href="{{ block.settings.button_link }}"
          {% else %}
            role="link"
            aria-disabled="true"
          {% endif %}
          class="
            book-spine-panel__cta
            {% if button_style == 'link' %}
              link
            {% else %}
              {{ button_style }}
            {% endif %}
          "
          {% if block.settings.open_in_new_tab and has_link %}
            target="_blank"
            rel="noopener noreferrer"
          {% endif %}
        >
          {{ block.settings.button_label }}
        </a>
      {% endif %}
    </div>
  </div>
</div>

{% schema %}
{
  "name": "Book spine panel",
  "settings": [
    {
      "type": "header",
      "content": "t:content.content"
    },
    {
      "type": "text",
      "id": "spine_label",
      "label": "Spine label",
      "default": "Spotlight"
    },
    {
      "type": "text",
      "id": "eyebrow",
      "label": "Eyebrow"
    },
    {
      "type": "text",
      "id": "heading",
      "label": "t:settings.heading",
      "default": "Tell your story"
    },
    {
      "type": "select",
      "id": "heading_tag",
      "label": "t:settings.heading_size",
      "options": [
        {
          "value": "h2",
          "label": "H2"
        },
        {
          "value": "h3",
          "label": "H3"
        },
        {
          "value": "h4",
          "label": "H4"
        }
      ],
      "default": "h3"
    },
    {
      "type": "richtext",
      "id": "body",
      "label": "t:settings.text",
      "default": "<p>Add a short description for this panel.</p>"
    },
    {
      "type": "text",
      "id": "button_label",
      "label": "t:settings.label",
      "default": "t:text_defaults.shop_now_button_label"
    },
    {
      "type": "url",
      "id": "button_link",
      "label": "t:settings.link"
    },
    {
      "type": "checkbox",
      "id": "open_in_new_tab",
      "label": "t:settings.open_new_tab",
      "default": false
    },
    {
      "type": "select",
      "id": "button_style",
      "label": "t:settings.style",
      "options": [
        {
          "value": "button",
          "label": "t:options.primary"
        },
        {
          "value": "button-secondary",
          "label": "t:options.secondary"
        },
        {
          "value": "link",
          "label": "t:options.link"
        }
      ],
      "default": "button"
    },
    {
      "type": "header",
      "content": "t:content.media"
    },
    {
      "type": "image_picker",
      "id": "image",
      "label": "t:settings.image"
    },
    {
      "type": "select",
      "id": "image_position",
      "label": "t:settings.image_position",
      "options": [
        {
          "value": "cover",
          "label": "t:options.cover"
        },
        {
          "value": "contain",
          "label": "t:options.contain"
        },
        {
          "value": "fit",
          "label": "t:options.fit"
        }
      ],
      "default": "cover"
    },
    {
      "type": "text",
      "id": "placeholder",
      "label": "Placeholder (optional)",
      "default": "hero-apparel-2"
    },
    {
      "type": "color",
      "id": "overlay_color",
      "label": "t:settings.overlay_color",
      "default": "#000000"
    },
    {
      "type": "range",
      "id": "overlay_opacity",
      "label": "t:settings.overlay_opacity",
      "min": 0,
      "max": 90,
      "step": 5,
      "default": 40,
      "unit": "%"
    },
    {
      "type": "header",
      "content": "t:content.layout"
    },
    {
      "type": "range",
      "id": "content_padding",
      "label": "t:settings.padding",
      "min": 0,
      "max": 80,
      "step": 4,
      "default": 40,
      "unit": "px"
    },
    {
      "type": "range",
      "id": "content_gap",
      "label": "t:settings.gap",
      "min": 0,
      "max": 48,
      "step": 4,
      "default": 24,
      "unit": "px"
    },
    {
      "type": "select",
      "id": "content_alignment",
      "label": "t:settings.vertical_alignment",
      "options": [
        {
          "value": "flex-start",
          "label": "t:options.top"
        },
        {
          "value": "center",
          "label": "t:options.center"
        },
        {
          "value": "flex-end",
          "label": "t:options.bottom"
        }
      ],
      "default": "center"
    },
    {
      "type": "checkbox",
      "id": "stack_mobile",
      "label": "t:settings.vertical_on_mobile",
      "default": true
    }
  ]
}
{% endschema %}
